CREATE DATABASE `kami`;

USE `kami`;

CREATE TABLE `direccion` (
    `id_direccion` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `calle` VARCHAR(45),
    `numero` INT(8),
    `pais` VARCHAR(45),
    `poblacion` VARCHAR(45),
    `provincia` VARCHAR(45),
    `codigo_postal` INT
);

CREATE TABLE `empresa` (
    `id_empresa` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `cif` VARCHAR(8),
    `nombre` VARCHAR(45),
    `id_direccion` INT,
    FOREIGN KEY (id_direccion)
        REFERENCES direccion (id_direccion)
);

CREATE TABLE `tipo_empresa` (
    `id_tipo` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `tipo` VARCHAR(9) CHECK (tipo IN (`propia` , `cliente`, `proveedor`))
);

CREATE TABLE `empresa_tipo_empresa` (
    `id_tipo` INT,
    FOREIGN KEY (`id_tipo`)
        REFERENCES `tipo_empresa` (`id_tipo`),
    `id_empresa` INT,
    FOREIGN KEY (`id_empresa`)
        REFERENCES `empresa` (`id_empresa`)
);

CREATE TABLE `email` (
    `id_email` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `email` VARCHAR(45) UNIQUE,
    `id_empresa` INT,
    FOREIGN KEY (`id_empresa`)
        REFERENCES `empresa` (`id_empresa`)
);

CREATE TABLE `telefono` (
    `id_telefono` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `telefono` INT UNIQUE,
    `id_empresa` INT,
    FOREIGN KEY (`id_empresa`)
        REFERENCES `empresa` (`id_empresa`)
);

CREATE TABLE `fax` (
    `id_fax` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `fax` INT UNIQUE,
    `id_empresa` INT,
    FOREIGN KEY (`id_empresa`)
        REFERENCES `empresa` (`id_empresa`)
);

CREATE TABLE `proyecto` (
    `id_proyecto` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `nombre` VARCHAR(45),
    `fecha_inicio` DATE,
    `fecha_fin` DATE,
    `id_empresa` INT,
    FOREIGN KEY (`id_empresa`)
        REFERENCES `empresa` (`id_empresa`),
    CHECK (`fecha_fin` >= `fecha_inicio`)
);

CREATE TABLE `pedido` (
    `id_pedido` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `fecha_entrada` DATE,
    `fecha_entrega` DATE,
    `id_proyecto` INT,
    FOREIGN KEY (`id_proyecto`)
        REFERENCES `proyecto` (`id_proyecto`),
    CHECK (`fecha_entrega` >= `fecha_entrada`)
);

CREATE TABLE `cantidad` (
    `id_cantidad` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `cantidad` INT
);

CREATE TABLE `producto` (
    `id_producto` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `nombre` VARCHAR(45),
    `descripcion` VARCHAR(150),
    `costo` DOUBLE,
    `pvp` DOUBLE
);

CREATE TABLE `pedido_cantidad_producto` (
    `id_pedido` INT,
    FOREIGN KEY (`id_pedido`)
        REFERENCES `pedido` (`id_pedido`),
    `id_cantidad` INT,
    FOREIGN KEY (`id_cantidad`)
        REFERENCES `cantidad` (`id_cantidad`),
    `id_producto` INT,
    FOREIGN KEY (`id_producto`)
        REFERENCES `producto` (`id_producto`)
);

